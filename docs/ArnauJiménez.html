<!DOCTYPE HTML>
<!--
	Helios by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>

<head>
	<title>Code - Arnau Jiménez</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
	<link rel="stylesheet" href="assets/css/main.css" />
	<link rel="stylesheet" href="assets/css/personal.css" />
	<noscript>
		<link rel="stylesheet" href="assets/css/noscript.css" />
	</noscript>
	<link rel="shortcut icon" type="image/png" href="images/icons/favicon.png">
</head>

<body style="align-items: center;">
	<div>

		<!-- Header -->
		<div id="header">

			<!-- Inner -->
			<header>
				<video autoplay muted loop id="video-background"
					style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 1;">
					<source src="images/videos/banner.mp4" type="video/mp4">
					Your browser does not support the video tag.
				</video>
				<div id="video-overlay"
					style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 2;">
				</div>
			</header>


			<!-- Nav -->
			<nav id="nav" style="z-index: 20;">
				<ul>
					<li><a href="index.html">Home</a></li>
					<li>
						<a href="teams.html">Teams</a>
						<ul>
							<li><a href="ArtTeam.html">Art</a></li>
							<li><a href="CodeTeam.html">Code</a></li>
							<li><a href="DesignTeam.html">Design</a></li>
							<li><a href="LeadsTeam.html">Leads</a></li>
						</ul>
					</li>
					<li><a href="engine.html">Engine</a></li>
					<li><a href="production.html">Production</a></li>
					<li><a href="postmortem.html">Post-Mortem</a></li>
					<li><a href="https://github.com/Shadow-Wizard-Games/TheOneEngine" target="_blank">Source Code</a>
					</li>
				</ul>
			</nav>
		</div>

		<!-- Main -->
		<div class="bio-body">
            <div class="bio-container">
                <h1 class="bio-name">Arnau Jiménez</h1>
                <img src="images/members/code/arnau.jpg" alt="Profile Picture" class="bio-profile-pic">
                <p class="bio-description">
                    Hi, my name is Arnau Jiménez, an Undergraduate student of Videogame Design 
                    and Development at Centre de la Imatge i Tecnologia Multimedia in Barcelona, 
                    Spain. I'm passionate about everything that surrounds video games, computers and new technologies.
                </p>
                <div class="member-links">
					<a href="https://github.com/Historn" target="_blank" class="link-icon"><i
							class="fab fa-github"></i></a>
					<a href="https://www.linkedin.com/in/arnau-jim%C3%A9nez-gallego-a789281a6/" target="_blank"
						class="link-icon"><i class="fab fa-linkedin"></i></a>
				</div>
            </div>
        </div>
        <hr />
      
        <div style="display: flex; justify-content: center; padding-top: 20px; align-items: center; flex-direction: column;">
            <div>
                <div>
                    <h2 style="font-family: Alien Invader; color: rgb(0, 252, 0); text-align: center;">Background</h2>
                    <h3 style="font-family: Alien Invader; color: white; padding-top: 40px; padding-bottom: 20px; text-align: center; font-size: 32px;">
                        About Me
                    </h3>
                    <p style="padding: 0px 0px 0 0; text-align: center; color: white; padding-left: 80px; padding-right: 80px; text-align: center; font-size: 24px;">
                        My journey with video games and technology began at the tender age of four when I 
                        received my first computer and a Game Boy Color, things that made me develop my 
                        interest for them along the years.
                        <br><br>

                        I have studied a Superior Grade on 3D Animations, Games and Interactive Environments, 
                        Professional Profile on Virtual Worlds, Augmented Reality and Gamification (2019 - 2021) at Sant Marc de Sarrià School. 
                        <br><br>

                        I am particularly fascinated by game development and coding, constantly 
                        seeking to improve my skills and knowledge. During my studies, I have participated in numerous projects:
                        <a href="https://github.com/Shadow-Wizard-Games/TheOneEngine" class="styled-link">Alien: Nemesis</a>, 
                        <a href="https://clearenginestudio.itch.io/marem-kannas-adventure" class="styled-link">MAREM</a>,
                        <a href="https://github.com/VicMarBall/VR-Project" class="styled-link">The Hound of Hades</a>,
                        <a href="https://github.com/PauFusco/LeFish" class="styled-link">LeFish</a>,
                        <a href="https://github.com/Shadow-Wizard-Games/TheOneEngine" class="styled-link">TheOneEngine</a>, and 
                        <a href="https://github.com/Fun-Makers-Studios/Project2_TheToyBox" class="styled-link">TheToyBox</a>

                    </p>
                </div>
                <hr />
                <div style="display:block; align-items: center; justify-content: center;">
                    <h2 style="font-family: Alien Invader; color: rgb(0, 252, 0); text-align: center; padding-top: 20px;">Project Overview</h2>
                    <p style="padding: 0px 0px 0 0; text-align: center; color: white; padding-left: 60px; padding-right: 60px; text-align: center; font-size: 24px; padding-top: 20px;">
                        In this project I was responsible for the development of the Light Pass shaders and module to 
                        allow work with lighting in the game, creating Dynamic Shadow Mapping shader implementation. 
                        I was also involved in the development and implementation of Mono and the Scripting Engine (objects and components structure), 
                        also worked on Prefabs structure, Scene Manager and general gameplay scripting concepts.
                    </p>
                    <h3 style="font-family: Alien Invader; color: white; padding-top: 40px; padding-bottom: 20px; font-size: 32px; text-align: center;">
                        Main Tasks
                    </h3>
                    <div style="display:flex; flex-direction: row; justify-content: center; flex-wrap: wrap;">
                        <div class="bio-container" style="width: 800px;
                        position: relative;
                        margin: 40px;">
                        <h4 style="font-family: Alien Invader; color: white; padding-top: 40px; padding-bottom: 20px; color:rgb(250, 236, 156); text-decoration: underline; font-size: 32px; text-align: center;">Light Pass</h4>
                        <p style="padding: 0px 0px 0 0; text-align: center; color: white; padding-left: 10px; padding-right: 10px; font-size: 22px;">
                            Implementation of Deferred Shading pipeline, allowing to put thousands of lights without too much performance impact
                        </p>
                        <img src="images/bio/Arnau/LightVideo.gif" style="object-fit: cover; height:300px; width: 600px; border-radius: 5%;" alt="" />
                        </div>
                        <div class="bio-container" style="width: 800px;
                        position: relative;
                        margin: 40px;">
                        <h4 style="font-family: Alien Invader; color: white; padding-top: 40px; padding-bottom: 20px; color:rgb(250, 236, 156); text-decoration: underline; font-size: 32px; text-align: center;">Shadow Mapping</h4>
                        <p style="padding: 0px 0px 0 0; text-align: center; color: white; padding-left: 10px; padding-right: 10px; font-size: 22px;">
                            Implementation of dynamic shadows pipeline working for Spotlights.
                        </p>
                        <img src="images/bio/Arnau/4651819-200.png" style="object-fit: fill; height:340px; width: 400px; padding-top: 40px;" alt="" />
                        </div>
                        <div class="bio-container" style="width: 800px;
                        position: relative;
                        margin: 40px;">
                        <h4 style="font-family: Alien Invader; color: white; padding-top: 40px; padding-bottom: 20px; color:rgb(250, 236, 156); text-decoration: underline; font-size: 32px; text-align: center;">Scripting Engine</h4>
                        <p style="padding: 0px 0px 0 0; text-align: center; color: white; padding-left: 10px; padding-right: 10px; font-size: 22px;">
                            Worked on the design of the Scripts structure, linking and calls of TheOneEngine.
                        </p>
                        <img src="images/bio/Jonathan/EnemyBehavior.png" style="object-fit: cover; height:200px;" alt="" />
                        </div>
                        <div class="bio-container" style="width: 800px;
                        position: relative;
                        margin: 40px;">
                        <h4 style="font-family: Alien Invader; color: white; padding-top: 40px; padding-bottom: 20px; color:rgb(250, 236, 156); text-decoration: underline; font-size: 32px; text-align: center;">SceneManager</h4>
                        <p style="padding: 0px 0px 0 0; text-align: center; color: white; padding-left: 10px; padding-right: 10px; font-size: 22px;">
                            Designed and implemented the module that manages all the scenes in the Engine, Editor and Gameplay
                        </p>
                        <img src="images/engine/TheOneLogo.png" style="object-fit: cover; height:200px;" alt="" />
                        </div>
                        <div class="bio-container" style="width: 800px;
                        position: relative;
                        margin: 40px;">
                        <h4 style="font-family: Alien Invader; color: white; padding-top: 40px; padding-bottom: 20px; color:rgb(250, 236, 156); text-decoration: underline; font-size: 32px; text-align: center;">Bugfixing and Problem Solving</h4>
                        <p style="padding: 0px 0px 0 0; text-align: center; color: white; padding-left: 10px; padding-right: 10px; font-size: 22px;">
                            Helped team members on fixing important issues found during the Engine and Game development.
                        </p>
                        </div>
                        <div class="bio-container" style="width: 800px;
                        position: relative;
                        margin: 40px;">
                        <h4 style="font-family: Alien Invader; color: white; padding-top: 40px; padding-bottom: 20px; color:rgb(250, 236, 156); text-decoration: underline; font-size: 32px; text-align: center;">Voice Acting</h4>
                        <p style="padding: 0px 0px 0 0; text-align: center; color: white; padding-left: 10px; padding-right: 10px; font-size: 22px;">
                            Created the voice lines for the character Isaac.
                        </p>
                        </div>
                        <div class="bio-container" style="width: 800px;
                        position: relative;
                        margin: 40px;">
                        <h4 style="font-family: Alien Invader; color: white; padding-top: 40px; padding-bottom: 20px; color:rgb(250, 236, 156); text-decoration: underline; font-size: 32px; text-align: center;">Prefabs</h4>
                        <p style="padding: 0px 0px 0 0; text-align: center; color: white; padding-left: 10px; padding-right: 10px; font-size: 22px;">
                            Designed and started the implementation of the prefabs structure allowing to create predefined GameObjects
                        </p>
                        <img src="images/bio/Arnau/cube-icon-logo-5E588A2E6F-seeklogo.com.png" style="object-fit: cover; height:200px;" alt="" />
                        </div>
                    </div>
                </div>
                <hr>
                <h2 style="font-family: Alien Invader; color: rgb(0, 252, 0); text-align: center; padding-top: 20px; padding-bottom: 40px;">Code Snippets</h2>
                <div style="display: flex; flex-direction: row; justify-content: space-evenly">
                    <div style="display: flex; flex-direction: column; align-items: left; justify-content: left; width: 400px;">
                    <h4 style="font-family: Alien Invader; color: white; padding-top: 40px; padding-bottom: 20px; color:rgb(250, 236, 156); font-size: 28px; text-align: left;">
                        Component Retriever</h4>
                        <p style="padding: 0px 0px 0 0; color: white; font-size: 22px; text-align: left;">
                            Engine functionality to enable
                            for components to be retrieved within the scene. 
                        </p>
                    </div>
                    <div id="editor1" class="editor-container"></div>
                </div>
                <div style="display: flex; flex-direction: row; justify-content: space-evenly; padding-top: 80px;">
                    <div id="editor2" class="editor-container"></div>
                    <div style="display: flex; flex-direction: column; align-items: right; justify-content: right; width: 400px;">
                        <h4 style="font-family: Alien Invader; color: white; padding-top: 40px; padding-bottom: 20px; color:rgb(250, 236, 156); font-size: 28px; text-align: right;">
                            GameObject - Component Linking</h4>
                            <p style="padding: 0px 0px 0 0; color: white; font-size: 22px; text-align: right;">IObject class allowing for linking between GameObjects and respective components</p>
                        </div>
                </div>
                <div style="display: flex; flex-direction: row; justify-content: space-evenly; padding-top: 80px;">
                    <div style="display: flex; flex-direction: column; align-items: left; justify-content: left; width: 400px;">
                    <h4 style="font-family: Alien Invader; color: white; padding-top: 40px; padding-bottom: 20px; color:rgb(250, 236, 156); font-size: 28px; text-align: left;">
                        Animated Mesh Geometry Pass</h4>
                        <p style="padding: 0px 0px 0 0; color: white; font-size: 22px; text-align: left;">
                            Rendering stage where animated 3D models, including their vertex deformations and skeletal animations, are processed and drawn to the screen
                        </p>
                    </div>
                    <div id="editor3" class="editor-container"></div>
                </div>
                <div style="display: flex; flex-direction: row; justify-content: space-evenly; padding-top: 80px;">
                    <div id="editor4" class="editor-container"></div>
                    <div style="display: flex; flex-direction: column; align-items: right; justify-content: right; width: 400px;">
                        <h4 style="font-family: Alien Invader; color: white; padding-top: 40px; padding-bottom: 20px; color:rgb(250, 236, 156); font-size: 28px; text-align: right;">
                            Light Pass & Shadow Mapping</h4>
                            <p style="padding: 0px 0px 0 0; color: white; font-size: 22px; text-align: right;">
                                Light Pass applys lighting calculations to the scene, enhancing realism. "Shadow Mapping" creates dynamic shadows, generated from the light's perspective.
                            </p>
                        </div>
                </div>
        
        <hr>
        </div>     
       
            
		<!-- Footer -->
		<div id="footer">
			<div class="container">

				<div class="row">
					<div class="col-12">

						<!-- Contact -->
						<section class="contact">
							<header>
								<h3 style="color: rgb(0, 255, 0);">Want more?</h3>
							</header>
							<p style="color: white;">Check us out below!</p>
							<ul class="icons">
								<li><a href="https://x.com/ShadowWizGames" target="_blank"
										class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>

								<li><a href="https://www.instagram.com/shadow.wizard.games/" target="_blank"
										class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>

								<li><a href="https://shadowwizardgames.tumblr.com/" target="_blank"
										class="icon brands fa-tumblr"><span class="label">Tumblr</span></a>
								</li>
								<li><a href="mailto:shadow.wizard.m.games@gmail.com" class="icon fa-envelope"><span
											class="label">Email</span></a>
							</ul>
						</section>

						<!-- Copyright -->
						<div class="copyright">
							<ul class="menu">
								<li>&copy; Alien: Nemesis - Shadow Wizard Games. All rights reserved.</li>
							</ul>
						</div>
					</div>

				</div>
			</div>
		</div>

	</div>

	<!-- Scripts -->
	<script src="assets/js/jquery.min.js"></script>
	<script src="assets/js/jquery.dropotron.min.js"></script>
	<script src="assets/js/jquery.scrolly.min.js"></script>
	<script src="assets/js/jquery.scrollex.min.js"></script>
	<script src="assets/js/browser.min.js"></script>
	<script src="assets/js/breakpoints.min.js"></script>
	<script src="assets/js/util.js"></script>
	<script src="assets/js/main.js"></script>
	<script src="assets/js/Code.js"></script>
	<script src="assets/js/playbuttondelay.js"></script>
    <script>
        function openTab(evt, tabName) {
            // Declare all variables
            var i, tabcontent, tablinks;
    
            // Get all elements with class="bio-tab-content" and hide them
            tabcontent = document.getElementsByClassName("bio-tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
                tabcontent[i].classList.remove('active');
            }
    
            // Get all elements with class="bio-tab" and remove the class "active"
            tablinks = document.getElementsByClassName("bio-tab");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
    
            // Show the current tab, and add an "active" class to the button that opened the tab
            document.getElementById(tabName).style.display = "block";
            document.getElementById(tabName).classList.add('active');
            evt.currentTarget.className += " active";
        }
    </script>
    <script>
                        // Define an object to store slide indexes for each slideshow
            let slideIndexes = {};

            // Initialize slide indexes for each slideshow
            function initSlideIndexes() {
                let slideshowContainers = document.querySelectorAll('.slideshow-container');
                slideshowContainers.forEach((container, index) => {
                    slideIndexes['slideshow' + (index + 1)] = 1; // Initialize slide index to 1 for each slideshow
                });
            }

            function showSlides(slideshowIndex, n) {
                let slides = document.querySelectorAll('#' + slideshowIndex + ' .weaponassets');
                if (n > slides.length) { slideIndexes[slideshowIndex] = 1; }
                if (n < 1) { slideIndexes[slideshowIndex] = slides.length; }
                slides.forEach((slide, index) => {
                    slide.style.display = "none";
                });
                slides[slideIndexes[slideshowIndex] - 1].style.display = "block";

                // Update the slide index text
                let slideIndexText = document.querySelector('#' + slideshowIndex + ' .numbertext');
                if (slideIndexText) {
                    slideIndexText.textContent = slideIndexes[slideshowIndex] + ' / ' + slides.length;
                }
            }

            // Change slide for a specific slideshow
            function plusSlides(slideshowIndex, n) {
                showSlides(slideshowIndex, slideIndexes[slideshowIndex] += n);
            }

            // Set up slide indexes for all slideshows
            initSlideIndexes();

            // Show the initial slides for all slideshows
            Object.keys(slideIndexes).forEach(slideshowIndex => {
                showSlides(slideshowIndex, slideIndexes[slideshowIndex]);
            });
    </script>

</body>

</html>

<script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.5.0/model-viewer.min.js"></script>
<!-- Monaco Editor -->
<script src="https://cdn.jsdelivr.net/npm/monaco-editor/min/vs/loader.js"></script>
<script>
    require.config({ paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor/min/vs' }});
    require(['vs/editor/editor.main'], function() {
        function createEditor(id, value, language) {
            const container = document.getElementById(id);
            const editor = monaco.editor.create(container, {
                value: value,
                language: language,
                theme: 'vs-dark',
                readOnly: true // Set editor to read-only
            });

            // Inject CSS rules to round the corners of the editor
            const styleElement = document.createElement('style');
            styleElement.innerHTML = `
                .monaco-editor .overflow-guard,
                .monaco-editor .monaco-scrollable-element {
                    border-radius: 10px;
                    overflow: hidden !important;
                    border: none !important; /* Ensure no border */
                }
            `;
            editor._domElement.appendChild(styleElement); // Append style to the editor's DOM

            // Adjust the layout to fit the container size
            function resizeEditor() {
                const containerRect = container.getBoundingClientRect();
                editor.layout({
                    width: containerRect.width,
                    height: containerRect.height
                });
            }

            // Trigger layout adjustment after editor creation and after a small delay
            resizeEditor();
            setTimeout(resizeEditor, 100); // Delay to ensure correct dimensions

            // Adjust layout on window resize
            window.addEventListener('resize', resizeEditor);
        }

        // Initialize editors
        function initializeEditors() {
        // Editor 1
        createEditor('editor1', `
//Used to get any component except scripts
public TComponent GetComponent<TComponent>() where TComponent : IComponent
{
    IntPtr component = IntPtr.Zero;

    TComponent componentToReturn = null;

    if (Enum.TryParse(typeof(TComponent).ToString(), out IComponent.ComponentType type))
    {
        component = InternalCalls.ComponentCheck(containerGOptr, (int)type);

        if (component != IntPtr.Zero)
        {

            switch (type)
            {
                case IComponent.ComponentType.ITransform:
                    componentToReturn = new ITransform(containerGOptr) as TComponent;
                    break;
                case IComponent.ComponentType.ICamera:
                    componentToReturn = new ICamera(containerGOptr) as TComponent;
                    Debug.LogCheck("The GetType of the class is: " + type.ToString());
                    break;
                case IComponent.ComponentType.ICollider2D:
                    componentToReturn = new ICollider2D(containerGOptr) as TComponent;
                    Debug.LogCheck("The GetType of the class is: " + type.ToString());
                    break;
                case IComponent.ComponentType.ICanvas:
                    componentToReturn = new ICanvas(containerGOptr) as TComponent;
                    break;
                case IComponent.ComponentType.IAudioSource:
                    componentToReturn = new IAudioSource(containerGOptr) as TComponent;
                    break;
                case IComponent.ComponentType.IParticleSystem:
                    componentToReturn = new IParticleSystem(containerGOptr) as TComponent;
                    break;
                case IComponent.ComponentType.IAnimator:
                    componentToReturn = new IAnimator(containerGOptr) as TComponent;
                    break;
                case IComponent.ComponentType.ILight:
                    componentToReturn = new ILight(containerGOptr) as TComponent;
                    break;
                default:
                    break;
            }
        }
    }
    else if (typeof(TComponent).IsSubclassOf(typeof(MonoBehaviour)))
    {
        component = InternalCalls.ComponentCheck(containerGOptr, (int)IComponent.ComponentType.MonoBehaviour, typeof(TComponent).ToString());

        if (component != IntPtr.Zero)
        {
            componentToReturn = InternalCalls.GetScript<TComponent>(containerGOptr, typeof(TComponent).ToString());
        }
    }


    if (componentToReturn != null)
    {
        return componentToReturn;
    }
    else
    {
        return new IComponent() as TComponent;
    }
}

`, 'cpp');

        // Editor 2
        createEditor('editor2', `//Base Class for Components and GameObjects to be linked in some way
public class IObject
{
    protected IntPtr containerGOptr;

    public string name
    {
        get
        {
            return InternalCalls.GetGameObjectName(containerGOptr);
        }
        set
        {
            InternallCalls.SetGameObjectName(containerGOptr, ref value);
        }
    }

    public bool isActive;

    public IObject()
    {
        containerGOptr = InternalCalls.GetGameObjectPtr();
    }

    public IObject(IntPtr gameObjectRef)
    {
        containerGOptr = gameObjectRef;
    }
}

public class IComponent : IObject
{
    public enum ComponentType
    {
        ITransform,
        ICamera,
        IMesh,
        ITexture,
        MonoBehaviour,
        ICollider2D,
        ICanvas,
        IListener,
        IAudioSource,
        IParticleSystem,
        IAnimator,
        ILight,
        Unknown
    }

    public IComponent() : base() { }
    public IComponent(IntPtr gameObjectRef) : base(gameObjectRef) { }
}

//Class that compose any scriptable object
public class MonoBehaviour : IComponent
{
    public IGameObject attachedGameObject;
    public MonoBehaviour() : base() { attachedGameObject = new IGameObject(containerGOptr); }

    public Managers managers = new Managers();

    public object GetClassInstance()
    {
        return this;
    }

    public virtual void Start() { }
    public virtual void Update() { }
}`, 'cpp');

        // Editor 3
        createEditor('editor3', `//Animated Mesh Geometry Pass
#version 450 core

layout(location = 0) out vec4 gAlbedoSpec;
layout(location = 1) out vec3 gPosition;
layout(location = 2) out vec3 gNormal;

in vec2 TexCoords;
in vec3 fragPos;
in vec3 normal;

uniform sampler2D diffuse;

void main() {
    // store the fragment position vector in the first gbuffer texture
    gPosition = fragPos;
    // also store the per-fragment normals into the gbuffer
    gNormal = normalize(normal);
    // and the diffuse per-fragment color
    vec4 textureDiffuse = texture(diffuse, vec2(TexCoords.s, 1. - TexCoords.t));
    //Detect if the fragment has texture binded
    if(textureDiffuse.a < 0.1)
    {
        discard;
    }
    else
    {
        gAlbedoSpec = textureDiffuse;
    }
}`, 'cpp');

// Editor 4
createEditor('editor4', `//Light Pass and Shadow Mapping
#version 450 core

const int MAX_DIRECTIONAL_LIGHTS = 4;
const int MAX_POINT_LIGHTS = 32;
const int MAX_SPOT_LIGHTS = 16;

// Outputs colors in RGBA
out vec4 FragColor;

in vec2 TexCoords;

uniform sampler2D gPosition;
uniform sampler2D gNormal;
uniform sampler2D gAlbedoSpec;

struct DirLight
{
    vec3 Position;
    vec3 Color;
    float Intensity;
    vec3 Direction;
};

struct PointLight
{
    vec3 Position;
    vec3 Color;
    float Intensity;
    
    float Linear;
    float Quadratic;
    float Radius;
}; 

struct SpotLight
{
    vec3 Position;
    vec3 Color;
    float Intensity;
    vec3 Direction;

    float Linear;
    float Quadratic;
    float Radius;

    float CutOff;
    float OuterCutOff;

    mat4 ViewProjectionMat;

    sampler2D Depth;
};

uniform int u_TotalLightsNum;
uniform DirLight u_DirLight[MAX_DIRECTIONAL_LIGHTS];
uniform PointLight u_PointLights[MAX_POINT_LIGHTS];
uniform SpotLight u_SpotLights[MAX_SPOT_LIGHTS];

uniform vec3 u_ViewPos;

const float PI = 3.14159265359;

float ShadowCalculation(vec4 fragPosLightSpace, vec3 Normal, sampler2D DepthMap, vec3 FragPos, vec3 lightPos)
{
    // perform perspective divide
    vec3 projCoords = fragPosLightSpace.xyz / fragPosLightSpace.w;
    // transform to [0,1] range
    projCoords = projCoords * 0.5 + 0.5;
    // get closest depth value from light's perspective (using [0,1] range fragPosLight as coords)
    float closestDepth = texture(DepthMap, projCoords.xy).r; 
    // get depth of current fragment from light's perspective
    float currentDepth = projCoords.z;
    // calculate bias (based on depth map resolution and slope)
    vec3 normal = normalize(Normal);
    vec3 lightDir = normalize(lightPos - FragPos);
    float bias = max(0.025 * (1.0 - dot(normal, lightDir)), 0.0001);
    // check whether current frag pos is in shadow
    // float shadow = currentDepth - bias > closestDepth  ? 1.0 : 0.0;
    // PCF
    float shadow = 0.0;
    vec2 texelSize = 1.0 / textureSize(DepthMap, 0);
    for(int x = -1; x <= 1; ++x)
    {
        for(int y = -1; y <= 1; ++y)
        {
            float pcfDepth = texture(DepthMap, projCoords.xy + vec2(x, y) * texelSize).r; 
            shadow += currentDepth - bias > pcfDepth  ? 1.0 : 0.0;        
        }    
    }
    shadow /= 9.0;
    
    // keep the shadow at 0.0 when outside the far_plane region of the light's frustum.
    if(projCoords.z > 1.0)
        shadow = 0.0;
        
    return shadow;
}

vec3 CalcDirLight(DirLight light, vec3 Diffuse, float Specular, vec3 Normal, vec3 FragPos, vec3 ViewDir)
{
    // diffuse
    vec3 lightDir = normalize(-light.Direction);
    vec3 diffuse = max(dot(Normal, lightDir), 0.0) * Diffuse * light.Color;
    // specular
    vec3 halfwayDir = normalize(lightDir + ViewDir);
    float spec = pow(max(dot(Normal, halfwayDir), 0.0), 16.0);
    vec3 specular = light.Color * spec * Specular;

    return ((diffuse + specular) * light.Intensity * 0.1);
}

vec3 CalcPointLight(PointLight light, vec3 Diffuse, float Specular, vec3 Normal, vec3 FragPos, vec3 ViewDir)
{
    float distance = length(light.Position - FragPos);
    if(distance > light.Radius) return vec3(0.0);

    // diffuse
    vec3 lightDir = normalize(light.Position - FragPos);
    vec3 diffuse = max(dot(Normal, lightDir), 0.0) * Diffuse * light.Color;
    // specular
    vec3 halfwayDir = normalize(lightDir + ViewDir);
    float spec = pow(max(dot(Normal, halfwayDir), 0.0), 16.0);
    vec3 specular = light.Color * spec * Specular;
    // attenuation
    float attenuation = 1.0 / (1.0 + light.Linear * distance + light.Quadratic * distance * distance);

    return ((diffuse + specular) * attenuation * (light.Intensity * 500.0));
}

vec3 CalcSpotLight(SpotLight light, vec3 Diffuse, float Specular, vec3 Normal, vec3 FragPos, vec3 ViewDir)
{
    float distance = length(light.Position - FragPos);
    if(distance > light.Radius) return vec3(0.0);

    // diffuse
    vec3 lightDir = normalize(light.Position - FragPos);
    float r = length(lightDir);
    vec3 diffuse = max(dot(Normal, lightDir), 0.0) * Diffuse * light.Color;
    
    // specular
    vec3 halfwayDir = normalize(lightDir + ViewDir);
    float spec = pow(max(dot(Normal, halfwayDir), 0.0), 16.0);
    vec3 specular = light.Color * spec * Specular;

    // spotlight (soft edges)
    float theta = dot(lightDir, normalize(-light.Direction));
    float epsilon = (light.CutOff - light.OuterCutOff);
    float intensity = clamp((theta - light.OuterCutOff) / epsilon, 0.0, 1.0);

    // attenuation
    float attenuation = 1.0 / (1.0 + light.Linear * distance + light.Quadratic * distance * distance);

    vec4 FragPosLightSpace = light.ViewProjectionMat * vec4(FragPos, 1.0);
    float shadow = ShadowCalculation(FragPosLightSpace, Normal, light.Depth, FragPos, light.Position);

    return ((1.0 - shadow) * (diffuse + specular) * intensity * attenuation * (light.Intensity * 500.0));
}

void main()
{
    vec3 FragPos    = texture(gPosition, TexCoords).rgb;
    vec3 Normal     = texture(gNormal, TexCoords).rgb;
    vec3 Diffuse    = texture(gAlbedoSpec, TexCoords).rgb;
    float Alpha     = texture(gAlbedoSpec, TexCoords).a;
    vec3 ViewDir    = normalize(u_ViewPos - FragPos);
    float Specular  = 0.1;

    vec3 result = Diffuse * 0.1;

    // phase 1: Directional lighting
    for(int i = 0; i < MAX_DIRECTIONAL_LIGHTS; i++)
    result += CalcDirLight(u_DirLight[i], Diffuse, Specular, Normal, FragPos, ViewDir);

    // phase 2: Point lights
    for(int i = 0; i < MAX_POINT_LIGHTS; i++)
    result += CalcPointLight(u_PointLights[i], Diffuse, Specular, Normal, FragPos, ViewDir);

    // phase 3: Spot lights
    for(int i = 0; i < MAX_SPOT_LIGHTS; i++)
    result += CalcSpotLight(u_SpotLights[i], Diffuse, Specular, Normal, FragPos, ViewDir);

    FragColor = vec4(result, 1.0);
}`, 'cpp');}
// Wait for the window to fully load before initializing editors
window.onload = function() {
            initializeEditors();
            setTimeout(function() {
                document.querySelectorAll('.editor-container').forEach(container => {
                    const event = new Event('resize');
                    window.dispatchEvent(event);
                });
            }, 100);
        };
    });
</script>

