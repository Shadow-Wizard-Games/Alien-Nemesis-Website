<!DOCTYPE HTML>
<!--
	Helios by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>

<head>
	<title>Code - Héctor Báscones</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
	<link rel="stylesheet" href="assets/css/main.css" />
	<link rel="stylesheet" href="assets/css/personal.css" />
	<noscript>
		<link rel="stylesheet" href="assets/css/noscript.css" />
	</noscript>
	<link rel="shortcut icon" type="image/png" href="images/icons/favicon.png">
</head>

<body style="align-items: center;">
	<div>

		<!-- Header -->
		<div id="header">

			<!-- Inner -->
			<header>
				<video autoplay muted loop id="video-background"
					style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 1;">
					<source src="images/videos/banner.mp4" type="video/mp4">
					Your browser does not support the video tag.
				</video>
				<div id="video-overlay"
					style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 2;">
				</div>
			</header>


			<!-- Nav -->
			<nav id="nav" style="z-index: 20;">
				<ul>
					<li><a href="index.html">Home</a></li>
					<li>
						<a href="teams.html">Teams</a>
						<ul>
							<li><a href="ArtTeam.html">Art</a></li>
							<li><a href="CodeTeam.html">Code</a></li>
							<li><a href="DesignTeam.html">Design</a></li>
							<li><a href="LeadsTeam.html">Leads</a></li>
						</ul>
					</li>
					<li><a href="engine.html">Engine</a></li>
					<li><a href="production.html">Production</a></li>
					<li><a href="postmortem.html">Post-Mortem</a></li>
					<li><a href="https://github.com/Shadow-Wizard-Games/TheOneEngine" target="_blank">Source Code</a>
					</li>
				</ul>
			</nav>
		</div>

		<!-- Main -->
		<div class="bio-body">
            <div class="bio-container">
                <h1 class="bio-name">Héctor Báscones</h1>
                <img src="images/members/code/hekbas.png" alt="Profile Picture" class="bio-profile-pic">
                <p class="bio-description">
                    Hello there! I’m Héctor Báscones, undergraduate student at CITM - UPC. 
                    I am currently pursuing a degree in Game Design and Development in Barcelona.
                </p>
                <div class="member-links">
					<a href="https://github.com/Hekbas" target="_blank" class="link-icon"><i
							class="fab fa-github"></i></a>
					<a href="https://www.linkedin.com/in/h%C3%A9ctor-b%C3%A1scones-zamora-30554b263" target="_blank"
						class="link-icon"><i class="fab fa-linkedin"></i></a>
				</div>
            </div>
        </div>
        <hr />
      
        <div style="display: flex; justify-content: center; padding-top: 20px; align-items: center; flex-direction: column;">
            <div>
                <div>
                    <h2 style="font-family: Alien Invader; color: rgb(0, 252, 0); text-align: center;">Background</h2>
                    <h3 style="font-family: Alien Invader; color: white; padding-top: 40px; padding-bottom: 20px; text-align: center; font-size: 32px;">
                        About Me
                    </h3>
                    <p style="padding: 0px 0px 0 0; text-align: center; color: white; padding-left: 80px; padding-right: 80px; text-align: center; font-size: 24px;">
                        Video Games, films and novels have undoubtedly been the major motivations for hobbies 
                        such as drawing and photography since I was young. Pursuing an engineering degree in 
                        Telecommunications soon pushed away such hobbies, and replaced them with math, electronics and coding.
                        <br>
                        <br> 
                        Such is life that I got in touch with the gaming world again, and a newborn passion was lit in me when I 
                        discovered this field, where I can express myself while solving difficult problems in creative ways.
                        <br>
                        <br> 
                        I’m excited to begin my journey into game development, and tackling this project has just reinforced my 
                        trust that I’m on the right path.
                        

                    </p>
                </div>
                <hr />
                <div style="display:block; align-items: center; justify-content: center;">
                    <h2 style="font-family: Alien Invader; color: rgb(0, 252, 0); text-align: center; padding-top: 20px;">Project Overview</h2>
                    <p style="padding: 0px 0px 0 0; text-align: center; color: white; padding-left: 60px; padding-right: 60px; text-align: center; font-size: 24px; padding-top: 20px;">
                        As a member of the code team, I have actively participated in the development of the engine, building 
                        from the ground up modules that have helped shape our game.
                        <br>
                        <br>
                        During the development of this project I’ve learned to work together 
                        with my team to tackle difficult tasks efficiently, which has led me to learn new things outside my area of expertise and overall, grow as a programmer.

                    </p>
                    <h3 style="font-family: Alien Invader; color: white; padding-top: 40px; padding-bottom: 20px; font-size: 32px; text-align: center;">
                        Main Tasks
                    </h3>
                    <div style="display:flex; flex-direction: row; justify-content: center; flex-wrap: wrap;">
                        <div class="bio-container" style="width: 800px;
                        position: relative;
                        margin: 40px;">
                        <h4 style="font-family: Alien Invader; color: white; padding-top: 40px; color:rgb(250, 236, 156); text-decoration: underline; font-size: 32px; text-align: center;">Animation Module</h4>
                        <p style="padding: 0px 0px 0 0; text-align: center; color: white; padding-left: 10px; padding-right: 10px; font-size: 18px;">
                            Alongside Alex Delgado, I implemented an animation module from scratch, using the Ozz-Animation library. 
                            This involved building the necessary .lib files, creating a new project and Implementing:
                            <img src="images/bio/hector/animation.gif" style="object-fit: cover; height:460px; width: 680px; padding-top: 20px;" alt="" />
                            <div style="display: flex; flex-direction: row; justify-content: space-evenly; flex-wrap: wrap;">
                                <li style="font-size: 18px; color: rgb(9, 255, 0); font-weight: bold; margin: 10px; text-wrap: nowrap;">Animator and animation  files</li>
                                    <li style="font-size: 18px; color: rgb(9, 255, 0); font-weight: bold; margin: 10px; text-wrap: nowrap;">Fbx to custom .mesh tools</li>
                                    <li style="font-size: 18px; color: rgb(9, 255, 0); font-weight: bold; margin: 10px; text-wrap: nowrap;">Play / Pause / Set Speed</li>
                                    <li style="font-size: 18px; color: rgb(9, 255, 0); font-weight: bold; margin: 10px; text-wrap: nowrap;">Support for partial blending</li>
                                    <li style="font-size: 18px; color: rgb(9, 255, 0); font-weight: bold; margin: 10px; text-wrap: nowrap;">Animation Panel for the Editor</li>
                            </div>
                        </p>
                        
                        </div>
                        <div class="bio-container" style="width: 800px;
                        position: relative;
                        margin: 40px;">
                        <h4 style="font-family: Alien Invader; color: white; padding-top: 40px; color:rgb(250, 236, 156); text-decoration: underline; font-size: 32px; text-align: center;">Render / Post Process Pipeline</h4>
                        <p style="padding: 0px 0px 0 0; text-align: center; color: white; padding-left: 10px; padding-right: 10px; font-size: 18px;">
                            At some point, the 2D and 3D rendering modules had to be managed concurrently with a variety of Shader effects. 
                            To achieve this, I developed a Render / Post-Processing pipeline that could manage multiple rendering targets, 
                            as well as offering the necessary functionality to create and manage OpenGL’s Framebuffers and Attachments. 
                            <img src="images/bio/hector/render.gif" style="object-fit: cover; height:300px; width: 700px; padding-top: 20px;" alt="" />
                            <h4 style="padding-top: 10px; color:rgb(9, 255, 0); font-size: 24px; text-align: center;">Implementation</h4>
                            <div style="display: flex; flex-direction: row; justify-content: space-evenly; flex-wrap: wrap;">
                                <li style="font-size: 18px; color: rgb(255, 255, 255); font-weight: bold; margin: 5px; text-wrap: nowrap;">Deferred Rendering / Lighting</li>
                                    <li style="font-size: 18px; color: rgb(255, 255, 255); font-weight: bold; margin: 5px; text-wrap: nowrap;">Real Time Shadow Mapping</li>
                                    <li style="font-size: 18px; color: rgb(255, 255, 255); font-weight: bold; margin: 5px; text-wrap: nowrap;">Pixel Art Effect</li>
                                    <li style="font-size: 18px; color: rgb(255, 255, 255); font-weight: bold; margin: 5px; text-wrap: nowrap;">Texture Filtering</li>
                                    <li style="font-size: 18px; color: rgb(255, 255, 255); font-weight: bold; margin: 5px; text-wrap: nowrap;">CRT Monitor Shader</li>
                            </div>
                            <h4 style="padding-top: 10px; color:rgb(9, 255, 0); font-size: 24px; text-align: center; padding-top: 20px;">Research, Viability and Testing</h4>
                            <div style="display: flex; flex-direction: row; justify-content: space-evenly; flex-wrap: wrap;">
                                <li style="font-size: 18px; color: rgb(255, 255, 255); font-weight: bold; margin: 5px; text-wrap: nowrap;">SSAO</li>
                                    <li style="font-size: 18px; color: rgb(255, 255, 255); font-weight: bold; margin: 5px; text-wrap: nowrap;">Bloom</li>
                                    <li style="font-size: 18px; color: rgb(255, 255, 255); font-weight: bold; margin: 5px; text-wrap: nowrap;">Edge Detection</li>
                                    <li style="font-size: 18px; color: rgb(255, 255, 255); font-weight: bold; margin: 5px; text-wrap: nowrap;">Color Quantization & Dithering</li>
                                    <li style="font-size: 18px; color: rgb(255, 255, 255); font-weight: bold; margin: 5px; text-wrap: nowrap;">DepthBuffer Fog</li>
                            </div>
                        </p>
                        </div>
                        <div class="bio-container" style="width: 800px;
                        position: relative;
                        margin: 40px;">
                        <h4 style="font-family: Alien Invader; color: white; padding-top: 40px; color:rgb(250, 236, 156); text-decoration: underline; font-size: 32px; text-align: center;">Engine Usability</h4>
                        <p style="padding: 0px 0px 0 0; text-align: center; color: white; padding-left: 10px; padding-right: 10px; font-size: 18px;">
                            As much work as we put in the initial development of the engine, due to time constraints and lack of knowledge in certain areas, 
                            some functionalities of TheOne need to be reworked or implemented from scratch.
                            <div style="display: flex; flex-direction: column; justify-content: space-evenly; flex-wrap: wrap;">
                                <li style="font-size: 18px; color: rgb(9, 255, 0); font-weight: bold; margin: 10px; text-wrap: nowrap;">Overhaul Transform Component, Quaternions, ImGuizmo</li>
                                    <li style="font-size: 18px; color: rgb(9, 255, 0); font-weight: bold; margin: 10px; text-wrap: nowrap;">Redesign Camera Component</li>
                                    <li style="font-size: 18px; color: rgb(9, 255, 0); font-weight: bold; margin: 10px; text-wrap: nowrap;">Frustum Culling</li>
                                    <li style="font-size: 18px; color: rgb(9, 255, 0); font-weight: bold; margin: 10px; text-wrap: nowrap;">Raycasting</li>
                            </div>
                        </p>
                        <img src="images/engine/TheOneLogo.png" style="object-fit: cover; height:200px; width: 200px; border-radius: 5%;" alt="" />
                        </div>
                        <div class="bio-container" style="width: 800px;
                        position: relative;
                        margin: 40px;">
                        <h4 style="font-family: Alien Invader; color: white; padding-top: 40px; color:rgb(250, 236, 156); text-decoration: underline; font-size: 32px; text-align: center;">Editor Design / Utilities</h4>
                        <p style="padding: 0px 0px 0 0; text-align: center; color: white; padding-left: 10px; padding-right: 10px; font-size: 18px;">
                            I’ve poured my passion for game development in TheOneEngine since its foundation 6 months ago, and I must admit I've grown attached to it.
                            I have taken extra care to streamline the Engine’s built-in Editor, not only to provide functionality for the development 
                            of the game, but to offer a pleasant and user oriented experience.
                        </p>
                        <img src="images/bio/hector/editor.png" style="object-fit: cover; height:420px; width: 760px; border-radius: 5%;" alt="" />
                        </div>
                    </div>
                </div>
                
                <hr>
                <h2 style="font-family: Alien Invader; color: rgb(0, 252, 0); text-align: center; padding-top: 20px; padding-bottom: 40px;">Code Snippets</h2>
                <div style="display: flex; flex-direction: row; justify-content: space-evenly">
                    <div style="display: flex; flex-direction: column; align-items: left; justify-content: left; width: 400px;">
                    <h4 style="font-family: Alien Invader; color: white; padding-top: 40px; padding-bottom: 20px; color:rgb(250, 236, 156); font-size: 28px; text-align: left;">
                        CRT Shader</h4>
                        <p style="padding: 0px 0px 0 0; color: white; font-size: 22px; text-align: left;">
                            Shader stylizing game to look as though it is on a CRT display. 
                        </p>
                    </div>
                    <div id="editor1" class="editor-container"></div>
                </div>
                <div style="display: flex; flex-direction: row; justify-content: space-evenly; padding-top: 80px;">
                    <div id="editor2" class="editor-container"></div>
                    <div style="display: flex; flex-direction: column; align-items: right; justify-content: right; width: 400px;">
                        <h4 style="font-family: Alien Invader; color: white; padding-top: 40px; padding-bottom: 20px; color:rgb(250, 236, 156); font-size: 28px; text-align: right;">
                            Renderer Pipeline</h4>
                            <p style="padding: 0px 0px 0 0; color: white; font-size: 22px; text-align: right;">Pipeline for game rendering</p>
                        </div>
                </div>
        
        <hr>
        </div>     
       
            
		<!-- Footer -->
		<div id="footer">
			<div class="container">

				<div class="row">
					<div class="col-12">

						<!-- Contact -->
						<section class="contact">
							<header>
								<h3 style="color: rgb(0, 255, 0);">Want more?</h3>
							</header>
							<p style="color: white;">Check us out below!</p>
							<ul class="icons">
								<li><a href="https://x.com/ShadowWizGames" target="_blank"
										class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>

								<li><a href="https://www.instagram.com/shadow.wizard.games/" target="_blank"
										class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>

								<li><a href="https://shadowwizardgames.tumblr.com/" target="_blank"
										class="icon brands fa-tumblr"><span class="label">Tumblr</span></a>
								</li>
								<li><a href="mailto:shadow.wizard.m.games@gmail.com" class="icon fa-envelope"><span
											class="label">Email</span></a>
							</ul>
						</section>

						<!-- Copyright -->
						<div class="copyright">
							<ul class="menu">
								<li>&copy; Alien: Nemesis - Shadow Wizard Games. All rights reserved.</li>
							</ul>
						</div>
					</div>

				</div>
			</div>
		</div>

	</div>

	<!-- Scripts -->
	<script src="assets/js/jquery.min.js"></script>
	<script src="assets/js/jquery.dropotron.min.js"></script>
	<script src="assets/js/jquery.scrolly.min.js"></script>
	<script src="assets/js/jquery.scrollex.min.js"></script>
	<script src="assets/js/browser.min.js"></script>
	<script src="assets/js/breakpoints.min.js"></script>
	<script src="assets/js/util.js"></script>
	<script src="assets/js/main.js"></script>
	<script src="assets/js/Code.js"></script>
	<script src="assets/js/playbuttondelay.js"></script>
    <script>
        function openTab(evt, tabName) {
            // Declare all variables
            var i, tabcontent, tablinks;
    
            // Get all elements with class="bio-tab-content" and hide them
            tabcontent = document.getElementsByClassName("bio-tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
                tabcontent[i].classList.remove('active');
            }
    
            // Get all elements with class="bio-tab" and remove the class "active"
            tablinks = document.getElementsByClassName("bio-tab");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
    
            // Show the current tab, and add an "active" class to the button that opened the tab
            document.getElementById(tabName).style.display = "block";
            document.getElementById(tabName).classList.add('active');
            evt.currentTarget.className += " active";
        }
    </script>
    <script>
                        // Define an object to store slide indexes for each slideshow
            let slideIndexes = {};

            // Initialize slide indexes for each slideshow
            function initSlideIndexes() {
                let slideshowContainers = document.querySelectorAll('.slideshow-container');
                slideshowContainers.forEach((container, index) => {
                    slideIndexes['slideshow' + (index + 1)] = 1; // Initialize slide index to 1 for each slideshow
                });
            }

            function showSlides(slideshowIndex, n) {
                let slides = document.querySelectorAll('#' + slideshowIndex + ' .weaponassets');
                if (n > slides.length) { slideIndexes[slideshowIndex] = 1; }
                if (n < 1) { slideIndexes[slideshowIndex] = slides.length; }
                slides.forEach((slide, index) => {
                    slide.style.display = "none";
                });
                slides[slideIndexes[slideshowIndex] - 1].style.display = "block";

                // Update the slide index text
                let slideIndexText = document.querySelector('#' + slideshowIndex + ' .numbertext');
                if (slideIndexText) {
                    slideIndexText.textContent = slideIndexes[slideshowIndex] + ' / ' + slides.length;
                }
            }

            // Change slide for a specific slideshow
            function plusSlides(slideshowIndex, n) {
                showSlides(slideshowIndex, slideIndexes[slideshowIndex] += n);
            }

            // Set up slide indexes for all slideshows
            initSlideIndexes();

            // Show the initial slides for all slideshows
            Object.keys(slideIndexes).forEach(slideshowIndex => {
                showSlides(slideshowIndex, slideIndexes[slideshowIndex]);
            });
    </script>

</body>

</html>

<script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.5.0/model-viewer.min.js"></script>
<!-- Monaco Editor -->
<script src="https://cdn.jsdelivr.net/npm/monaco-editor/min/vs/loader.js"></script>
<script>
    require.config({ paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor/min/vs' }});
    require(['vs/editor/editor.main'], function() {
        function createEditor(id, value, language) {
            const container = document.getElementById(id);
            const editor = monaco.editor.create(container, {
                value: value,
                language: language,
                theme: 'vs-dark',
                readOnly: true // Set editor to read-only
            });

            // Inject CSS rules to round the corners of the editor
            const styleElement = document.createElement('style');
            styleElement.innerHTML = `
                .monaco-editor .overflow-guard,
                .monaco-editor .monaco-scrollable-element {
                    border-radius: 10px;
                    overflow: hidden !important;
                    border: none !important; /* Ensure no border */
                }
            `;
            editor._domElement.appendChild(styleElement); // Append style to the editor's DOM

            // Adjust the layout to fit the container size
            function resizeEditor() {
                const containerRect = container.getBoundingClientRect();
                editor.layout({
                    width: containerRect.width,
                    height: containerRect.height
                });
            }

            // Trigger layout adjustment after editor creation and after a small delay
            resizeEditor();
            setTimeout(resizeEditor, 100); // Delay to ensure correct dimensions

            // Adjust layout on window resize
            window.addEventListener('resize', resizeEditor);
        }

        // Initialize editors
        function initializeEditors() {
        // Editor 1
        createEditor('editor1', `//------------------------
// Smol CRT Shader ~hekbas
//------------------------

#version 450 core
precision highp float;

uniform sampler2D albedo;
uniform vec2 warp;
uniform float time;

in vec2 fragCoord;
layout(location = 1) out vec4 fragColor;

vec2 kWarp = vec2(1.0 / warp.x, 1.0 / warp.y);

vec2 WarpUV(vec2 uv)
{
    uv = uv * 2.0 - 1.0;
    uv *= vec2(
        1.0 + (uv.y * uv.y) * kWarp.x,
        1.0 + (uv.x * uv.x) * kWarp.y
    );
    return uv * 0.5 + 0.5;
}

void DrawVignette(inout vec3 color, vec2 uv)
{
    float vignette = uv.x * uv.y * (1.0 - uv.x) * (1.0 - uv.y);
    vignette = clamp(pow(16.0 * vignette, 0.3), 0.0, 1.0);
    color *= vignette;
}

void DrawScanLine(inout vec3 color, vec2 uv)
{
    float scanline = clamp(0.95 + 0.05 * cos(3.14 * (uv.y + 0.008 * time) * 240.0 * 1.0), 0.0, 1.0);
    float grille = 0.85 + 0.15 * clamp(1.5 * cos(3.14 * uv.x * 640.0 * 1.0), 0.0, 1.0);
    color *= scanline * grille * 1.2;
}

void main()
{
    vec2 uv = fragCoord.xy;
    vec2 crtUV = WarpUV(uv);

    vec3 color = texture(albedo, crtUV).rgb;

    if(crtUV.x < 0.0 || crtUV.x > 1.0 || crtUV.y < 0.0 || crtUV.y > 1.0)
    {
        color = vec3(0.0, 0.0, 0.0);
    }

    DrawVignette(color, crtUV);

    DrawScanLine(color, crtUV);

    fragColor.xyz = color;
    fragColor.w = 1.0;
}
`, 'cpp');

        // Editor 2
        createEditor('editor2', `void Renderer::Update()
{
    Renderer2D::ResetStats();
    Renderer3D::ResetStats();

    for (auto& target : renderer.renderTargets)
    {
        if (!target.GetCamera() || !target.IsActive())
            continue;

        DrawMode drawMode = target.GetMode();

        Renderer::SetRenderEnvironment();
        SetUniformBufferCamera(target.GetCamera()->viewProjectionMatrix);
        engine->N_sceneManager->currentScene->Draw(drawMode, target.GetCamera());
        Renderer3D::Update(target);

        // gBuffer ------------------------------------------------
        Renderer3D::GeometryPass(target);

        if (settings.particlesLight.isEnabled)
            Renderer2D::Update(BatchType::WORLD, target);

        // shadowBuffer -------------------------------------------
        if (drawMode != DrawMode::BUILD_DEBUG)
        {
            if (settings.shadows.isEnabled)
                Renderer3D::ShadowPass(target);
        }

        // postBuffer ---------------------------------------------
        // Blit gBuffer Depth to postBuffer
        if (drawMode != DrawMode::BUILD_DEBUG)
        {
            if (Renderer3D::InitPostProcess(target))
            {
                if (settings.lights.isEnabled)
                    Renderer3D::LightPass(target);

                Renderer3D::IndexPass(target);

                if (Renderer::Settings()->particles.isEnabled)
                    Renderer2D::Update(BatchType::WORLD, target);
            }
            Renderer3D::EndPostProcess(target);

            if (drawMode == DrawMode::EDITOR)
            {
                Renderer::DrawDebug();
                Renderer2D::Update(BatchType::EDITOR, target);
            }
        }
            // uiBuffer -----------------------------------------------
        // Blit postBuffer Color to uiBuffer, draw UI on top
        if (drawMode != DrawMode::EDITOR)
        {
            Renderer3D::UIComposition(target);

            if (settings.crt.isEnabled)
                Renderer3D::CRTShader(target);
        }       

        // BUILD --------------------------------------------------
        // Blit final composition to 0 Buffer
        if (drawMode == DrawMode::BUILD_DEBUG || drawMode == DrawMode::BUILD_RELEASE)
        {
            FrameBuffer* uibuffer = target.GetFrameBuffer("uiBuffer");
            int glColorAttachmentID = drawMode == DrawMode::BUILD_RELEASE ? GL_COLOR_ATTACHMENT1 : GL_COLOR_ATTACHMENT0;

            GLCALL(glBindFramebuffer(GL_READ_FRAMEBUFFER, uibuffer->GetBuffer()));
            GLCALL(glBindFramebuffer(GL_DRAW_FRAMEBUFFER, 0));
            GLCALL(glReadBuffer(glColorAttachmentID));
            GLCALL(glBlitFramebuffer(
                0, 0, uibuffer->GetWidth(), uibuffer->GetHeight(),
                0, 0, uibuffer->GetWidth(), uibuffer->GetHeight(),
                GL_COLOR_BUFFER_BIT, GL_NEAREST));
        }
    }

    Renderer2D::ResetBatches();
    Renderer3D::ResetCalls();
}`, 'cpp');

        // Editor 3
        createEditor('editor3', `//Animated Mesh Geometry Pass
#version 450 core

layout(location = 0) out vec4 gAlbedoSpec;
layout(location = 1) out vec3 gPosition;
layout(location = 2) out vec3 gNormal;

in vec2 TexCoords;
in vec3 fragPos;
in vec3 normal;

uniform sampler2D diffuse;

void main() {
    // store the fragment position vector in the first gbuffer texture
    gPosition = fragPos;
    // also store the per-fragment normals into the gbuffer
    gNormal = normalize(normal);
    // and the diffuse per-fragment color
    vec4 textureDiffuse = texture(diffuse, vec2(TexCoords.s, 1. - TexCoords.t));
    //Detect if the fragment has texture binded
    if(textureDiffuse.a < 0.1)
    {
        discard;
    }
    else
    {
        gAlbedoSpec = textureDiffuse;
    }
}`, 'cpp');

// Editor 4
createEditor('editor4', `//Light Pass and Shadow Mapping
#version 450 core

const int MAX_DIRECTIONAL_LIGHTS = 4;
const int MAX_POINT_LIGHTS = 32;
const int MAX_SPOT_LIGHTS = 16;

// Outputs colors in RGBA
out vec4 FragColor;

in vec2 TexCoords;

uniform sampler2D gPosition;
uniform sampler2D gNormal;
uniform sampler2D gAlbedoSpec;

struct DirLight
{
    vec3 Position;
    vec3 Color;
    float Intensity;
    vec3 Direction;
};

struct PointLight
{
    vec3 Position;
    vec3 Color;
    float Intensity;
    
    float Linear;
    float Quadratic;
    float Radius;
}; 

struct SpotLight
{
    vec3 Position;
    vec3 Color;
    float Intensity;
    vec3 Direction;

    float Linear;
    float Quadratic;
    float Radius;

    float CutOff;
    float OuterCutOff;

    mat4 ViewProjectionMat;

    sampler2D Depth;
};

uniform int u_TotalLightsNum;
uniform DirLight u_DirLight[MAX_DIRECTIONAL_LIGHTS];
uniform PointLight u_PointLights[MAX_POINT_LIGHTS];
uniform SpotLight u_SpotLights[MAX_SPOT_LIGHTS];

uniform vec3 u_ViewPos;

const float PI = 3.14159265359;

float ShadowCalculation(vec4 fragPosLightSpace, vec3 Normal, sampler2D DepthMap, vec3 FragPos, vec3 lightPos)
{
    // perform perspective divide
    vec3 projCoords = fragPosLightSpace.xyz / fragPosLightSpace.w;
    // transform to [0,1] range
    projCoords = projCoords * 0.5 + 0.5;
    // get closest depth value from light's perspective (using [0,1] range fragPosLight as coords)
    float closestDepth = texture(DepthMap, projCoords.xy).r; 
    // get depth of current fragment from light's perspective
    float currentDepth = projCoords.z;
    // calculate bias (based on depth map resolution and slope)
    vec3 normal = normalize(Normal);
    vec3 lightDir = normalize(lightPos - FragPos);
    float bias = max(0.025 * (1.0 - dot(normal, lightDir)), 0.0001);
    // check whether current frag pos is in shadow
    // float shadow = currentDepth - bias > closestDepth  ? 1.0 : 0.0;
    // PCF
    float shadow = 0.0;
    vec2 texelSize = 1.0 / textureSize(DepthMap, 0);
    for(int x = -1; x <= 1; ++x)
    {
        for(int y = -1; y <= 1; ++y)
        {
            float pcfDepth = texture(DepthMap, projCoords.xy + vec2(x, y) * texelSize).r; 
            shadow += currentDepth - bias > pcfDepth  ? 1.0 : 0.0;        
        }    
    }
    shadow /= 9.0;
    
    // keep the shadow at 0.0 when outside the far_plane region of the light's frustum.
    if(projCoords.z > 1.0)
        shadow = 0.0;
        
    return shadow;
}

vec3 CalcDirLight(DirLight light, vec3 Diffuse, float Specular, vec3 Normal, vec3 FragPos, vec3 ViewDir)
{
    // diffuse
    vec3 lightDir = normalize(-light.Direction);
    vec3 diffuse = max(dot(Normal, lightDir), 0.0) * Diffuse * light.Color;
    // specular
    vec3 halfwayDir = normalize(lightDir + ViewDir);
    float spec = pow(max(dot(Normal, halfwayDir), 0.0), 16.0);
    vec3 specular = light.Color * spec * Specular;

    return ((diffuse + specular) * light.Intensity * 0.1);
}

vec3 CalcPointLight(PointLight light, vec3 Diffuse, float Specular, vec3 Normal, vec3 FragPos, vec3 ViewDir)
{
    float distance = length(light.Position - FragPos);
    if(distance > light.Radius) return vec3(0.0);

    // diffuse
    vec3 lightDir = normalize(light.Position - FragPos);
    vec3 diffuse = max(dot(Normal, lightDir), 0.0) * Diffuse * light.Color;
    // specular
    vec3 halfwayDir = normalize(lightDir + ViewDir);
    float spec = pow(max(dot(Normal, halfwayDir), 0.0), 16.0);
    vec3 specular = light.Color * spec * Specular;
    // attenuation
    float attenuation = 1.0 / (1.0 + light.Linear * distance + light.Quadratic * distance * distance);

    return ((diffuse + specular) * attenuation * (light.Intensity * 500.0));
}

vec3 CalcSpotLight(SpotLight light, vec3 Diffuse, float Specular, vec3 Normal, vec3 FragPos, vec3 ViewDir)
{
    float distance = length(light.Position - FragPos);
    if(distance > light.Radius) return vec3(0.0);

    // diffuse
    vec3 lightDir = normalize(light.Position - FragPos);
    float r = length(lightDir);
    vec3 diffuse = max(dot(Normal, lightDir), 0.0) * Diffuse * light.Color;
    
    // specular
    vec3 halfwayDir = normalize(lightDir + ViewDir);
    float spec = pow(max(dot(Normal, halfwayDir), 0.0), 16.0);
    vec3 specular = light.Color * spec * Specular;

    // spotlight (soft edges)
    float theta = dot(lightDir, normalize(-light.Direction));
    float epsilon = (light.CutOff - light.OuterCutOff);
    float intensity = clamp((theta - light.OuterCutOff) / epsilon, 0.0, 1.0);

    // attenuation
    float attenuation = 1.0 / (1.0 + light.Linear * distance + light.Quadratic * distance * distance);

    vec4 FragPosLightSpace = light.ViewProjectionMat * vec4(FragPos, 1.0);
    float shadow = ShadowCalculation(FragPosLightSpace, Normal, light.Depth, FragPos, light.Position);

    return ((1.0 - shadow) * (diffuse + specular) * intensity * attenuation * (light.Intensity * 500.0));
}

void main()
{
    vec3 FragPos    = texture(gPosition, TexCoords).rgb;
    vec3 Normal     = texture(gNormal, TexCoords).rgb;
    vec3 Diffuse    = texture(gAlbedoSpec, TexCoords).rgb;
    float Alpha     = texture(gAlbedoSpec, TexCoords).a;
    vec3 ViewDir    = normalize(u_ViewPos - FragPos);
    float Specular  = 0.1;

    vec3 result = Diffuse * 0.1;

    // phase 1: Directional lighting
    for(int i = 0; i < MAX_DIRECTIONAL_LIGHTS; i++)
    result += CalcDirLight(u_DirLight[i], Diffuse, Specular, Normal, FragPos, ViewDir);

    // phase 2: Point lights
    for(int i = 0; i < MAX_POINT_LIGHTS; i++)
    result += CalcPointLight(u_PointLights[i], Diffuse, Specular, Normal, FragPos, ViewDir);

    // phase 3: Spot lights
    for(int i = 0; i < MAX_SPOT_LIGHTS; i++)
    result += CalcSpotLight(u_SpotLights[i], Diffuse, Specular, Normal, FragPos, ViewDir);

    FragColor = vec4(result, 1.0);
}`, 'cpp');}
// Wait for the window to fully load before initializing editors
window.onload = function() {
            initializeEditors();
            setTimeout(function() {
                document.querySelectorAll('.editor-container').forEach(container => {
                    const event = new Event('resize');
                    window.dispatchEvent(event);
                });
            }, 100);
        };
    });
</script>

